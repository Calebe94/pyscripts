#!/usr/bin/python
import os
import dmenu
import json
import subprocess

def dmenu_show(message, items):
    return dmenu.show(
        items,
        prompt=message,
        background='#1c1f25',
        foreground='#f3f4f5',
        background_selected='#BD93F9',
        foreground_selected='#f3f4f5',
        font="San Francisco Display:size=12"
        )

ps = subprocess.Popen(['todo.sh', 'list'],stdin=subprocess.PIPE,stdout=subprocess.PIPE)
ps.wait()
one_line_output = ps.stdout.readlines()

lista = list()

for item in one_line_output:
        if not item.decode('utf-8').strip() == '--': 
                lista.append(item.decode('utf-8').strip())
        else:
                break

#print(one_line_output)


selected = dmenu_show("TODO", lista)

if selected in lista:
        pro = subprocess.Popen(['todo.sh', 'do', selected.split(' ')[0] ], stdout=subprocess.PIPE,stdin=subprocess.PIPE)
        print(pro.stdout.read().decode('utf-8'))
        # pro.stdin.write('y\n'.encode()) 
else:
        pro = subprocess.Popen(['todo.sh', 'add', selected ], stdout=subprocess.PIPE,stdin=subprocess.PIPE)
        print(pro.stdout.read().decode('utf-8'))